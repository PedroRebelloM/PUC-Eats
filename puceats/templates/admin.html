{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PUC Eats - Painel Administrativo</title>
    <link
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous"
    />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'css/admin.css' %}">
</head>
<body>
    <header class="admin-header">
        <div class="container">
            <div class="header-content">
                <div class="logo-section">
                    <div class="logo-icon">
                        <span class="material-icons">admin_panel_settings</span>
                    </div>
                    <div class="logo-text">
                        <h1>PUC <span class="text-accent">Eats</span></h1>
                        <p>Painel de Administração</p>
                    </div>
                </div>
                
                <div class="header-actions">
                    {% if user.is_authenticated %}
                    <div class="admin-badge">
                        <span class="material-icons" style="font-size: 18px;">verified_user</span>
                        <span>{{ user.first_name|default:user.username }}</span>
                    </div>
                    {% endif %}
                    
                    <a href="{% url 'puceats:index' %}" class="btn-header">
                        <span class="material-icons" style="font-size: 18px;">home</span>
                        <span>Início</span>
                    </a>
                    
                    {% if user.is_authenticated %}
                    <a href="{% url 'puceats:logout' %}" class="btn-header btn-logout">
                        <span class="material-icons" style="font-size: 18px;">logout</span>
                        <span class="d-none d-md-inline">Sair</span>
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
    </header>

    <main class="container py-4">
        <div class="row g-4 mb-5">
            <div class="col-12 col-sm-6 col-lg-3">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <span class="material-icons">people</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Usuários</p>
                        <h3 class="stat-value">{{ total_users }}</h3>
                        <p class="stat-description">Total cadastrados</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #9CCC65 0%, #8BC34A 100%);">
                        <span class="material-icons">restaurant</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Restaurantes</p>
                        <h3 class="stat-value">{{ total_restaurants }}</h3>
                        <p class="stat-description">Estabelecimentos ativos</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                        <span class="material-icons">lunch_dining</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Pratos</p>
                        <h3 class="stat-value">{{ total_dishes }}</h3>
                        <p class="stat-description">Pratos cadastrados</p>
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-6 col-lg-3">
                <div class="stat-card">
                    <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                        <span class="material-icons">vpn_key</span>
                    </div>
                    <div class="stat-content">
                        <p class="stat-label">Tokens</p>
                        <h3 class="stat-value">{{ tokens_available }}</h3>
                        <p class="stat-description">{{ tokens_used }} usados de {{ total_tokens }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabela de Usuários -->
        <div class="section-card mb-4">
            <div class="section-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="section-icon" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);">
                        <span class="material-icons">people</span>
                    </div>
                    <div>
                        <h2 class="section-title">Usuários Cadastrados</h2>
                        <p class="section-subtitle">Lista completa de todos os usuários da plataforma</p>
                    </div>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Nome</th>
                            <th>Username</th>
                            <th>Email</th>
                            <th>Tipo</th>
                            <th>Data de Cadastro</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for user in users %}
                        <tr>
                            <td><span class="badge-id">{{ user.id }}</span></td>
                            <td>
                                <div class="user-info">
                                    <div class="user-avatar">
                                        <span class="material-icons">person</span>
                                    </div>
                                    <span class="user-name">{{ user.first_name|default:"—" }}</span>
                                </div>
                            </td>
                            <td><span class="text-muted">{{ user.username }}</span></td>
                            <td>{{ user.email }}</td>
                            <td>
                                {% if user.is_superuser %}
                                <span class="badge-type badge-superuser">
                                    <span class="material-icons">admin_panel_settings</span>
                                    Administrador
                                </span>
                                {% else %}
                                <span class="badge-type badge-user">
                                    <span class="material-icons">person</span>
                                    Usuário
                                </span>
                                {% endif %}
                            </td>
                            <td>{{ user.date_joined|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if user.is_active %}
                                <span class="badge-status badge-active">
                                    <span class="status-dot"></span>
                                    Ativo
                                </span>
                                {% else %}
                                <span class="badge-status badge-inactive">
                                    <span class="status-dot"></span>
                                    Inativo
                                </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="7" class="text-center py-5">
                                <span class="material-icons text-muted mb-2" style="font-size: 48px;">people_outline</span>
                                <p class="text-muted">Nenhum usuário cadastrado</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tabela de Restaurantes -->
        <div class="section-card">
            <div class="section-header">
                <div class="d-flex align-items-center gap-3">
                    <div class="section-icon" style="background: linear-gradient(135deg, #9CCC65 0%, #8BC34A 100%);">
                        <span class="material-icons">restaurant</span>
                    </div>
                    <div>
                        <h2 class="section-title">Restaurantes Cadastrados</h2>
                        <p class="section-subtitle">Lista completa de todos os estabelecimentos da plataforma</p>
                    </div>
                </div>
            </div>
            
            <div class="table-responsive">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Restaurante</th>
                            <th>Proprietário</th>
                            <th>Tipo</th>
                            <th>Pratos</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for restaurant in restaurants %}
                        <tr>
                            <td><span class="badge-id">{{ restaurant.id }}</span></td>
                            <td>
                                <div class="restaurant-info">
                                    <div class="restaurant-icon">
                                        <span class="material-icons">
                                            {% if restaurant.establishment_type == 'restaurante' %}
                                            restaurant
                                            {% elif restaurant.establishment_type == 'lanchonete' %}
                                            lunch_dining
                                            {% elif restaurant.establishment_type == 'barraca' %}
                                            storefront
                                            {% else %}
                                            restaurant_menu
                                            {% endif %}
                                        </span>
                                    </div>
                                    <span class="restaurant-name">{{ restaurant.name }}</span>
                                </div>
                            </td>
                            <td>
                                <div class="owner-info">
                                    <span class="material-icons" style="font-size: 16px; color: #9ca3af;">person</span>
                                    <span>{{ restaurant.owner.first_name|default:restaurant.owner.username }}</span>
                                </div>
                            </td>
                            <td>
                                {% if restaurant.establishment_type == 'restaurante' %}
                                <span class="badge-establishment badge-restaurant">
                                    <span class="material-icons">restaurant</span>
                                    Restaurante
                                </span>
                                {% elif restaurant.establishment_type == 'lanchonete' %}
                                <span class="badge-establishment badge-lanchonete">
                                    <span class="material-icons">lunch_dining</span>
                                    Lanchonete
                                </span>
                                {% elif restaurant.establishment_type == 'barraca' %}
                                <span class="badge-establishment badge-barraca">
                                    <span class="material-icons">storefront</span>
                                    Barraca
                                </span>
                                {% else %}
                                <span class="badge-establishment badge-other">
                                    <span class="material-icons">restaurant_menu</span>
                                    Outro
                                </span>
                                {% endif %}
                            </td>
                            <td>
                                <div class="dishes-count">
                                    <span class="material-icons" style="font-size: 18px; color: #f59e0b;">lunch_dining</span>
                                    <span class="count-number">{{ restaurant.dishes.count }}</span>
                                    <span class="count-label">prato{{ restaurant.dishes.count|pluralize }}</span>
                                </div>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="text-center py-5">
                                <span class="material-icons text-muted mb-2" style="font-size: 48px;">restaurant_menu</span>
                                <p class="text-muted">Nenhum restaurante cadastrado</p>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
