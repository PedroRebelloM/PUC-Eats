{% extends 'base.html' %}
{% load static %}

{% block title %}PUC Eats{% endblock %}

{% block nav_index %}active{% endblock %}

{% block header_extra_buttons %}
<button class="icon-btn" id="sidebarToggle">
    <span class="material-icons">chevron_left</span>
</button>
{% endblock %}

{% block content %}
    <div class="main-container">
        <div id="map"></div>

        <!-- Lateral com scroll e restaurantes do banco -->
        <aside class="sidebar" style="overflow-y: auto;">
            <div class="sidebar-header">
                <h2>Restaurantes</h2>
                <p class="sidebar-subtitle">Lugares próximos para comer</p>
            </div>

            <div class="restaurant-list">
                {% for restaurant in restaurants %}
                <div class="restaurant-item" onclick="openRestaurantModal({{ restaurant.id }})">
                    <div class="restaurant-image">
                        {% if restaurant.logo %}
                        <img src="{{ restaurant.logo.url }}" alt="{{ restaurant.name }}">
                        {% else %}
                        <div class="restaurant-placeholder">
                            <span class="material-icons">restaurant</span>
                        </div>
                        {% endif %}
                    </div>
                    <div class="restaurant-info">
                        <h3 class="restaurant-name">{{ restaurant.name }}</h3>
                        <p class="restaurant-location">{{ restaurant.building|default:"Campus PUC" }}</p>
                        <p class="restaurant-cuisine">{{ restaurant.get_cuisine_type_display }}</p>
                    </div>
                </div>
                {% empty %}
                <p style="text-align: center; color: #666; padding: 20px;">
                    Nenhum restaurante cadastrado ainda.
                </p>
                {% endfor %}
            </div>
        </aside>
    </div>

    <div id="restaurantModal" class="restaurant-modal-overlay">
        <div class="restaurant-modal-content">
            <div class="restaurant-modal-header">
                <h2 id="modalRestaurantName">Carregando...</h2>
                <button class="restaurant-modal-close" onclick="closeRestaurantModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="restaurant-modal-body" id="modalRestaurantBody">
                <p style="text-align: center; padding: 20px;">Carregando cardápio...</p>
            </div>
        </div>
    </div>
{% endblock %}

{% block extra_scripts %}
<script>
        const pucRio = [-22.9794, -43.2329];
        
        const map = L.map('map', {
            center: pucRio,
            zoom: 15,
            minZoom: 18,
            maxZoom: 22,
            maxBounds: [
                [-22.9894, -43.2429],
                [-22.9694, -43.2229]
            ],
            maxBoundsViscosity: 1.0
        });

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: ''
        }).addTo(map);

        const customIcon = L.divIcon({
            className: 'custom-marker',
            html: '<div style="background-color: #9CCC65; width: 30px; height: 30px; border-radius: 50% 50% 50% 0; transform: rotate(-45deg); border: 3px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.3);"><div style="width: 10px; height: 10px; background-color: white; border-radius: 50%; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(45deg);"></div></div>',
            iconSize: [30, 30],
            iconAnchor: [15, 30]
        });

        L.marker(pucRio, {icon: customIcon}).addTo(map)
            .bindPopup('PUC-Rio');

        function openRestaurantModal(restaurantId) {
            console.log('Teste', restaurantId);
           
        }

</script>
{% endblock %}